------------------------------------------------
-- DDL Statements for Table "GALADM  "."QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX"
------------------------------------------------

DROP TRIGGER GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TR1;
DROP TRIGGER GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TR2;
DROP TABLE GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX;

CREATE TABLE GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX
(
	EXTERNAL_SYSTEM_DEFECT_MAP_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY 
		  (START WITH 1, INCREMENT BY 1, NO CACHE, NO MINVALUE, NO MAXVALUE, NO CYCLE, NO ORDER) ,	
	EXTERNAL_SYSTEM_NAME  CHAR(18),
	EXTERNAL_PART_CODE    VARCHAR(64),
	EXTERNAL_DEFECT_CODE  VARCHAR(64),
	LOCAL_DEFECT_COMBINATION_ID  INTEGER,
	CREATE_TIMESTAMP      TIMESTAMP,
	UPDATE_TIMESTAMP      TIMESTAMP,
	CREATE_USER           CHAR(11),
	UPDATE_USER           CHAR(11) )
 	IN GALTBSREF11 INDEX IN GALTBSIDX4 ;

COMMENT ON TABLE GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX IS 'NAQ Defect Mapping between External System and QICS';

CREATE UNIQUE INDEX GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_I1
  ON GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX (EXTERNAL_SYSTEM_DEFECT_MAP_ID);

ALTER TABLE GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX 
	ADD CONSTRAINT QI_EXTERNAL_SYSTEM_DEFECT_MAP_PK PRIMARY KEY (EXTERNAL_SYSTEM_DEFECT_MAP_ID);
	
CREATE INDEX GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_I2
	ON GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX (EXTERNAL_SYSTEM_NAME, EXTERNAL_PART_CODE, EXTERNAL_DEFECT_CODE);
	
CREATE INDEX GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_I3
	ON GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX (LOCAL_DEFECT_COMBINATION_ID);
		
ALTER TABLE GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX 
	ADD CONSTRAINT QI_EXTERNAL_SYSTEM_DEFECT_MAP_C1 CHECK 
		(CREATE_USER = UPPER(CREATE_USER));

ALTER TABLE GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX  
	ADD CONSTRAINT QI_EXTERNAL_SYSTEM_DEFECT_MAP_C2 CHECK 
		(UPDATE_USER = UPPER(UPDATE_USER));

ALTER TABLE GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX 
  DATA CAPTURE CHANGES
  PCTFREE 0
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;

CREATE TRIGGER GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TR1
  NO CASCADE BEFORE INSERT
  ON GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX
  REFERENCING NEW AS A
  FOR EACH ROW
  SET CREATE_TIMESTAMP=CURRENT_TIMESTAMP;

CREATE TRIGGER GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TR2
  NO CASCADE BEFORE UPDATE
  ON GALADM.QI_EXTERNAL_SYSTEM_DEFECT_MAP_TBX
  REFERENCING NEW AS A
  FOR EACH ROW
  SET UPDATE_TIMESTAMP=CURRENT_TIMESTAMP;
