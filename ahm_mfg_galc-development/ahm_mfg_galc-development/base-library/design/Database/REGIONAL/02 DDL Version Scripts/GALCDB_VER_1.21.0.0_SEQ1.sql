DROP TRIGGER GALADM.MC_PDDA_UNIT_TR2;
DROP TRIGGER GALADM.MC_PDDA_UNIT_TR1;
DROP TABLE GALADM.MC_PDDA_UNIT_TBX;

CREATE TABLE GALADM.MC_PDDA_UNIT_TBX (
   OPERATION_NAME     	CHARACTER(32) 	NOT NULL,
   PDDA_PLATFORM_ID		INTEGER 		NOT NULL,
   UNIT_NO 				CHAR(6) 		NOT NULL ,
   REV_ID           	BIGINT	 		NOT NULL,
   APPROVER_NO	     	CHARACTER(11),
   APPROVED				TIMESTAMP,
   DEPRECATED_REV_ID    BIGINT,
   DEPRECATER_NO		CHARACTER(11),
   DEPRECATED			TIMESTAMP,
   CREATE_TIMESTAMP		TIMESTAMP,
   UPDATE_TIMESTAMP		TIMESTAMP,
   CONSTRAINT MC_PDDA_UNIT_PK PRIMARY KEY 
     (OPERATION_NAME, PDDA_PLATFORM_ID,UNIT_NO,REV_ID)
)
  IN GALTBSREF12
  INDEX IN GALTBSIDX4;

ALTER TABLE GALADM.MC_PDDA_UNIT_TBX
  DATA CAPTURE CHANGES
  PCTFREE 0
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;

COMMENT ON TABLE GALADM.MC_PDDA_UNIT_TBX IS 'RMT MC_PDDA_UNIT is used by Manufacturing Control to define the active PDDA Platforms and Unit No associated to an Operation Name';
    
CREATE TRIGGER GALADM.MC_PDDA_UNIT_TR1
  NO CASCADE BEFORE INSERT
  ON GALADM.MC_PDDA_UNIT_TBX
  REFERENCING 
    NEW AS A
  FOR EACH ROW
SET CREATE_TIMESTAMP=CURRENT_TIMESTAMP;

CREATE TRIGGER GALADM.MC_PDDA_UNIT_TR2
  NO CASCADE BEFORE UPDATE
  ON GALADM.MC_PDDA_UNIT_TBX
  REFERENCING 
    NEW AS A
  FOR EACH ROW
SET UPDATE_TIMESTAMP=CURRENT_TIMESTAMP;


DROP TRIGGER GALADM.MC_PDDA_PLATFORM_TR2;
DROP TRIGGER GALADM.MC_PDDA_PLATFORM_TR1;
DROP TABLE GALADM.MC_PDDA_PLATFORM_TBX;

CREATE TABLE GALADM.MC_PDDA_PLATFORM_TBX (
   PDDA_PLATFORM_ID		INTEGER			NOT NULL 
     GENERATED BY DEFAULT
       AS IDENTITY (START WITH 0, INCREMENT BY 1, NO CACHE,
                    NO MINVALUE, NO MAXVALUE, NO CYCLE, NO ORDER),
   PLANT_LOC_CODE		CHARACTER(1)	NOT NULL,
   DEPT_CODE			CHARACTER(2)	NOT NULL,
   MODEL_YEAR_DATE		DECIMAL(5, 1)	NOT NULL,
   PROD_SCH_QTY			DECIMAL(5, 1)	NOT NULL,
   PROD_ASM_LINE_NO		CHARACTER(1)	NOT NULL,
   VEHICLE_MODEL_CODE	CHARACTER(1)	NOT NULL,
   ASM_PROC_NO			VARCHAR(5)		NOT NULL,
   REV_ID           	BIGINT	 		NOT NULL,   
   PROCESS_POINT_ID 	CHARACTER(16)	NOT NULL,
   PROCESS_SEQ_NUM  	INTEGER			NOT NULL,
   APPROVER_NO			CHARACTER(11),
   APPROVED				TIMESTAMP,
   DEPRECATED_REV_ID    BIGINT,
   DEPRECATER_NO		CHARACTER(11),
   DEPRECATED			TIMESTAMP,
   CREATE_TIMESTAMP		TIMESTAMP,
   UPDATE_TIMESTAMP		TIMESTAMP,
   CONSTRAINT MC_PDDA_PLATFORM_PK PRIMARY KEY 
     (PDDA_PLATFORM_ID)
)
  IN GALTBSREF12
  INDEX IN GALTBSIDX4;

ALTER TABLE GALADM.MC_PDDA_PLATFORM_TBX
  DATA CAPTURE CHANGES
  PCTFREE 0
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;

COMMENT ON TABLE GALADM.MC_PDDA_PLATFORM_TBX IS 'RMT MC_PDDA_PLATFORM is used by Manufacturing Control to link PDDA Plant Loc Code, Dept Code, Model Year Date, Prod Sch Qty, Prod ASM Line No, Vehicle Model Code, ASM Proc No to GALC Process Point ID';
    
CREATE TRIGGER GALADM.MC_PDDA_PLATFORM_TR1
  NO CASCADE BEFORE INSERT
  ON GALADM.MC_PDDA_PLATFORM_TBX
  REFERENCING 
    NEW AS A
  FOR EACH ROW
SET CREATE_TIMESTAMP=CURRENT_TIMESTAMP;

CREATE TRIGGER GALADM.MC_PDDA_PLATFORM_TR2
  NO CASCADE BEFORE UPDATE
  ON GALADM.MC_PDDA_PLATFORM_TBX
  REFERENCING 
    NEW AS A
  FOR EACH ROW
SET UPDATE_TIMESTAMP=CURRENT_TIMESTAMP;

CREATE UNIQUE INDEX GALADM.MC_PDDA_PLATFORM_I1
  ON GALADM.MC_PDDA_PLATFORM_TBX
    ( PLANT_LOC_CODE, DEPT_CODE, MODEL_YEAR_DATE, PROD_SCH_QTY, PROD_ASM_LINE_NO, VEHICLE_MODEL_CODE, ASM_PROC_NO, REV_ID )
  ALLOW REVERSE SCANS
  COMPRESS NO;
