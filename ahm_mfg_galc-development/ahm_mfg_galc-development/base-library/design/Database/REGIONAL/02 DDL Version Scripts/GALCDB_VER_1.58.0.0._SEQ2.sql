drop table GALADM.LET_SPOOL_TBX;
drop trigger GALADM.LET_SPOOL_TR1;
drop trigger GALADM.LET_SPOOL_TR2;
  
CREATE TABLE "GALADM"."LET_SPOOL_TBX" (
  "SPOOL_ID" INTEGER NOT NULL,
  "ENV_NAME" VARCHAR(16) NOT NULL,
  "LINE_NAME" VARCHAR(16) NOT NULL,
  "PORT_NUMBER" INTEGER NOT NULL,
  "XML_SAVE_LOCATION" VARCHAR(128),
  "EXCEPTION_SAVE_LOCATION" VARCHAR(128),
  "CREATE_TIMESTAMP" TIMESTAMP,
  "UPDATE_TIMESTAMP" TIMESTAMP
)
  IN "GALTBSDAT10"
  INDEX IN "GALTBSIDX3";
 
ALTER TABLE "GALADM"."LET_SPOOL_TBX"
  ADD CONSTRAINT LET_SPOOL_PK PRIMARY KEY
  ("SPOOL_ID");

CREATE UNIQUE INDEX "GALADM"."LET_SPOOL_I1"
  ON "GALADM"."LET_SPOOL_TBX" ("ENV_NAME", "LINE_NAME");
  
CREATE TRIGGER "GALADM"."LET_SPOOL_TR1"
  NO CASCADE BEFORE INSERT
  ON "GALADM"."LET_SPOOL_TBX"
  REFERENCING 
    NEW AS A
  FOR EACH ROW
  SET CREATE_TIMESTAMP = CURRENT_TIMESTAMP;

CREATE TRIGGER "GALADM"."LET_SPOOL_TR2"
  NO CASCADE BEFORE UPDATE
  ON "GALADM"."LET_SPOOL_TBX"
  REFERENCING 
    NEW AS A
  FOR EACH ROW
  SET UPDATE_TIMESTAMP = CURRENT_TIMESTAMP;

drop table GALADM.LET_MESSAGE_TBX;
drop trigger GALADM.LET_MESSAGE_TR1;
drop trigger GALADM.LET_MESSAGE_TR2;

CREATE TABLE "GALADM"."LET_MESSAGE_TBX" (
  "MESSAGE_ID" BIGINT NOT NULL GENERATED BY DEFAULT
    AS IDENTITY (START WITH 1, INCREMENT BY 1, NO CACHE,
    NO MINVALUE, NO MAXVALUE, NO CYCLE, NO ORDER),
  "TERMINAL_ID" CHAR(3) NOT NULL,
  "MESSAGE_TYPE" CHAR(4) NOT NULL,
  "SPOOL_ID" INTEGER NOT NULL,
  "IP_ADDRESS" VARCHAR(32),
  "PRODUCT_ID" VARCHAR(32),
  "BUILD_CODE" VARCHAR(20),
  "MAC_ADDRESS" VARCHAR(45),
  "TOTAL_STATUS" VARCHAR(10),
  "MESSAGE_HEADER" VARCHAR(16),
  "MESSAGE_REPLY" VARCHAR(16),
  "DURATION" DECIMAL(8,3),
  "XML_MESSAGE_BODY" XML,
  "EXCEPTION_MESSAGE_BODY" CLOB,
  "ACTUAL_TIMESTAMP" TIMESTAMP NOT NULL,
  "CREATE_TIMESTAMP" TIMESTAMP,
  "UPDATE_TIMESTAMP" TIMESTAMP
) 
  IN "GALTBS8K1"
  INDEX IN "GALTBSIDX3";
  
ALTER TABLE "GALADM"."LET_MESSAGE_TBX"
  ADD CONSTRAINT LET_MESSAGE_PK PRIMARY KEY
  ("MESSAGE_ID");
  
ALTER TABLE "GALADM"."LET_MESSAGE_TBX" 
  ADD FOREIGN KEY "LET_MESSAGE_FK1" 
	("SPOOL_ID")
  REFERENCES "GALADM"."LET_SPOOL_TBX"
	("SPOOL_ID")
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;
  
CREATE INDEX "GALADM"."LET_MESSAGE_I1"
  ON "GALADM"."LET_MESSAGE_TBX"
    (PRODUCT_ID)
  ALLOW REVERSE SCANS
  COMPRESS NO;
  
CREATE INDEX "GALADM"."LET_MESSAGE_I2"
  ON "GALADM"."LET_MESSAGE_TBX"
    (IP_ADDRESS)
  ALLOW REVERSE SCANS
  COMPRESS NO;
    
CREATE TRIGGER "GALADM"."LET_MESSAGE_TR1"
  NO CASCADE BEFORE INSERT
  ON "GALADM"."LET_MESSAGE_TBX"
  REFERENCING 
    NEW AS A
  FOR EACH ROW
  SET CREATE_TIMESTAMP = CURRENT_TIMESTAMP;

CREATE TRIGGER "GALADM"."LET_MESSAGE_TR2"
  NO CASCADE BEFORE UPDATE
  ON "GALADM"."LET_MESSAGE_TBX"
  REFERENCING 
    NEW AS A
  FOR EACH ROW
  SET UPDATE_TIMESTAMP = CURRENT_TIMESTAMP;
