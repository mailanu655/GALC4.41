insert into MC_REV_TBX(REV_ID, REV_DESC, ASSOCIATE_NO, REV_TYPE, REV_STATUS, PDDA_FORM_ID, CREATE_TIMESTAMP, UPDATE_TIMESTAMP) VALUES
(1, 'Initial config for NSX Weld', '27766', 'OPERATION', 'DEVELOPING', NULL, NULL, NULL);

select * from MC_REV_TBX;

insert into "GALADM"."MC_OP_REV_TBX"("OPERATION_NAME","OP_REV","REV_ID","OP_DESC","OP_TYPE","OP_VIEW","OP_PROCESSOR","OP_TIME","OP_CHECK","PROCESS_POINT_ID","OP_SEQ_NUM","DEVICE_ID","DEVICE_MSG","PDDA_UNIT_ID") values ('RF Sub Frame Damper House       ',1,1,'Create unique SN and stamp it as a 2D barcode','MADE_FROM','','com.honda.galc.service.datacollection.DataCollectionServiceImpl',null,1,'PP2             ',1,'PLC_WE_01                       ','RF_ASSY                         ',null);
insert into "GALADM"."MC_OP_REV_TBX"("OPERATION_NAME","OP_REV","REV_ID","OP_DESC","OP_TYPE","OP_VIEW","OP_PROCESSOR","OP_TIME","OP_CHECK","PROCESS_POINT_ID","OP_SEQ_NUM","DEVICE_ID","DEVICE_MSG","PDDA_UNIT_ID") values ('Abiation Right Front Lower      ',2,1,'Install Abiation Right Front Lower','INSTALLED_PART',null,'com.honda.galc.service.datacollection.DataCollectionServiceImpl',null,1,'PP2             ',2,'PLC_WE_01                       ','RF_ASSY                         ',null);
insert into "GALADM"."MC_OP_REV_TBX"("OPERATION_NAME","OP_REV","REV_ID","OP_DESC","OP_TYPE","OP_VIEW","OP_PROCESSOR","OP_TIME","OP_CHECK","PROCESS_POINT_ID","OP_SEQ_NUM","DEVICE_ID","DEVICE_MSG","PDDA_UNIT_ID") values ('Abiation Right Front Upper      ',3,1,'Install Abiation Right Front Upper','INSTALLED_PART',null,'com.honda.galc.service.datacollection.DataCollectionServiceImpl',null,1,'PP2             ',3,'PLC_WE_01                       ','RF_ASSY                         ',null);
insert into "GALADM"."MC_OP_REV_TBX"("OPERATION_NAME","OP_REV","REV_ID","OP_DESC","OP_TYPE","OP_VIEW","OP_PROCESSOR","OP_TIME","OP_CHECK","PROCESS_POINT_ID","OP_SEQ_NUM","DEVICE_ID","DEVICE_MSG","PDDA_UNIT_ID") values ('RF Assy                         ',4,1,'Install Right Front Assembly','MADE_FROM',null,'com.honda.galc.service.datacollection.DataCollectionServiceImpl',null,1,'PP3             ',1,'PLC_WE_01                       ','FRONT_COMP                      ',null);
insert into "GALADM"."MC_OP_REV_TBX"("OPERATION_NAME","OP_REV","REV_ID","OP_DESC","OP_TYPE","OP_VIEW","OP_PROCESSOR","OP_TIME","OP_CHECK","PROCESS_POINT_ID","OP_SEQ_NUM","DEVICE_ID","DEVICE_MSG","PDDA_UNIT_ID") values ('LF Assy                         ',5,1,'Install Left Front Assembly','INSTALLED_PART',null,'com.honda.galc.service.datacollection.DataCollectionServiceImpl',null,1,'PP3             ',2,'PLC_WE_01                       ','FRONT_COMP                      ',null);
insert into "GALADM"."MC_OP_REV_TBX"("OPERATION_NAME","OP_REV","REV_ID","OP_DESC","OP_TYPE","OP_VIEW","OP_PROCESSOR","OP_TIME","OP_CHECK","PROCESS_POINT_ID","OP_SEQ_NUM","DEVICE_ID","DEVICE_MSG","PDDA_UNIT_ID") values ('Front Comp                      ',6,1,'Install Front Comp','MADE_FROM',null,'com.honda.galc.service.datacollection.DataCollectionServiceImpl',null,1,'PP4             ',1,'PLC_WE_01                       ','FRAME_COMP                      ',null);
insert into "GALADM"."MC_OP_REV_TBX"("OPERATION_NAME","OP_REV","REV_ID","OP_DESC","OP_TYPE","OP_VIEW","OP_PROCESSOR","OP_TIME","OP_CHECK","PROCESS_POINT_ID","OP_SEQ_NUM","DEVICE_ID","DEVICE_MSG","PDDA_UNIT_ID") values ('RR Frame Damper House           ',7,1,'Install Right Rear Damper House','INSTALLED_PART',null,'com.honda.galc.service.datacollection.DataCollectionServiceImpl',null,1,'PP4             ',2,'PLC_WE_01                       ','FRAME_COMP                      ',null);
insert into "GALADM"."MC_OP_REV_TBX"("OPERATION_NAME","OP_REV","REV_ID","OP_DESC","OP_TYPE","OP_VIEW","OP_PROCESSOR","OP_TIME","OP_CHECK","PROCESS_POINT_ID","OP_SEQ_NUM","DEVICE_ID","DEVICE_MSG","PDDA_UNIT_ID") values ('LR Frame Damper House           ',8,1,'Install Left Rear Frame Damper House','INSTALLED_PART',null,'com.honda.galc.service.datacollection.DataCollectionServiceImpl',null,1,'PP4             ',3,'PLC_WE_01                       ','FRAME_COMP                      ',null);
insert into "GALADM"."MC_OP_REV_TBX"("OPERATION_NAME","OP_REV","REV_ID","OP_DESC","OP_TYPE","OP_VIEW","OP_PROCESSOR","OP_TIME","OP_CHECK","PROCESS_POINT_ID","OP_SEQ_NUM","DEVICE_ID","DEVICE_MSG","PDDA_UNIT_ID") values ('B-Pillar Comp                   ',9,1,'Install B-Pillar Comp','INSTALLED_PART',null,'com.honda.galc.service.datacollection.DataCollectionServiceImpl',null,1,'PP4             ',4,'PLC_WE_01                       ','FRAME_COMP                      ',null);

select * from GALADM.MC_OP_REV_TBX;


insert into "GALADM"."MC_OP_PART_REV_TBX"("OP_PART_ID","REV_ID","OPERATION_NAME","PART_ID","PART_TYPE","PART_VIEW","PART_PROCESSOR","DEVICE_ID","DEVICE_MSG","PART_NO","PART_DESC","PART_MASK","PART_MARK","PART_MAX_ATTEMPTS","MEASUREMENT_COUNT","PART_TIME","PART_CHECK") values (1,1,'RF Sub Frame Damper House       ','A0001','MADE_FROM',null,null,null,null,'11000NSX*                     ','RF Sub Frame Damper Hous','YW*',null,null,0,null,null);
insert into "GALADM"."MC_OP_PART_REV_TBX"("OP_PART_ID","REV_ID","OPERATION_NAME","PART_ID","PART_TYPE","PART_VIEW","PART_PROCESSOR","DEVICE_ID","DEVICE_MSG","PART_NO","PART_DESC","PART_MASK","PART_MARK","PART_MAX_ATTEMPTS","MEASUREMENT_COUNT","PART_TIME","PART_CHECK") values (2,1,'Abiation Right Front Lower      ','A0001','INSTALLED_PART',null,null,null,null,'22222NSX*                     ','Abiation Right Front Lower','L*','L1',null,0,null,null);
insert into "GALADM"."MC_OP_PART_REV_TBX"("OP_PART_ID","REV_ID","OPERATION_NAME","PART_ID","PART_TYPE","PART_VIEW","PART_PROCESSOR","DEVICE_ID","DEVICE_MSG","PART_NO","PART_DESC","PART_MASK","PART_MARK","PART_MAX_ATTEMPTS","MEASUREMENT_COUNT","PART_TIME","PART_CHECK") values (3,1,'Abiation Right Front Upper      ','A0001','INSTALLED_PART',null,null,null,null,'22333NSX*                     ','Abiation Right Front Upper','U*','U1',null,0,null,null);
insert into "GALADM"."MC_OP_PART_REV_TBX"("OP_PART_ID","REV_ID","OPERATION_NAME","PART_ID","PART_TYPE","PART_VIEW","PART_PROCESSOR","DEVICE_ID","DEVICE_MSG","PART_NO","PART_DESC","PART_MASK","PART_MARK","PART_MAX_ATTEMPTS","MEASUREMENT_COUNT","PART_TIME","PART_CHECK") values (4,1,'RF Assy                         ','A0001','MADE_FROM',null,null,null,null,'12300NSX*                     ','RF Assy','YW*',null,null,0,null,null);
insert into "GALADM"."MC_OP_PART_REV_TBX"("OP_PART_ID","REV_ID","OPERATION_NAME","PART_ID","PART_TYPE","PART_VIEW","PART_PROCESSOR","DEVICE_ID","DEVICE_MSG","PART_NO","PART_DESC","PART_MASK","PART_MARK","PART_MAX_ATTEMPTS","MEASUREMENT_COUNT","PART_TIME","PART_CHECK") values (5,1,'LF Assy                         ','A0001','INSTALLED_PART',null,null,null,null,'22300NSX*                     ','LF Assy','YW*',null,null,0,null,null);
insert into "GALADM"."MC_OP_PART_REV_TBX"("OP_PART_ID","REV_ID","OPERATION_NAME","PART_ID","PART_TYPE","PART_VIEW","PART_PROCESSOR","DEVICE_ID","DEVICE_MSG","PART_NO","PART_DESC","PART_MASK","PART_MARK","PART_MAX_ATTEMPTS","MEASUREMENT_COUNT","PART_TIME","PART_CHECK") values (6,1,'Front Comp                      ','A0001','MADE_FROM',null,null,null,null,'14000NSX*                     ','Front Comp','YW*',null,null,0,null,null);
insert into "GALADM"."MC_OP_PART_REV_TBX"("OP_PART_ID","REV_ID","OPERATION_NAME","PART_ID","PART_TYPE","PART_VIEW","PART_PROCESSOR","DEVICE_ID","DEVICE_MSG","PART_NO","PART_DESC","PART_MASK","PART_MARK","PART_MAX_ATTEMPTS","MEASUREMENT_COUNT","PART_TIME","PART_CHECK") values (7,1,'RR Frame Damper House           ','A0001','INSTALLED_PART',null,null,null,null,null,'RR Frame Damper House   ','YW*',null,null,0,null,null);
insert into "GALADM"."MC_OP_PART_REV_TBX"("OP_PART_ID","REV_ID","OPERATION_NAME","PART_ID","PART_TYPE","PART_VIEW","PART_PROCESSOR","DEVICE_ID","DEVICE_MSG","PART_NO","PART_DESC","PART_MASK","PART_MARK","PART_MAX_ATTEMPTS","MEASUREMENT_COUNT","PART_TIME","PART_CHECK") values (8,1,'LR Frame Damper House           ','A0001','INSTALLED_PART',null,null,null,null,null,'LR Frame Damper House','YW*',null,null,0,null,null);
insert into "GALADM"."MC_OP_PART_REV_TBX"("OP_PART_ID","REV_ID","OPERATION_NAME","PART_ID","PART_TYPE","PART_VIEW","PART_PROCESSOR","DEVICE_ID","DEVICE_MSG","PART_NO","PART_DESC","PART_MASK","PART_MARK","PART_MAX_ATTEMPTS","MEASUREMENT_COUNT","PART_TIME","PART_CHECK") values (9,1,'B-Pillar Comp                   ','A0001','INSTALLED_PART',null,null,null,null,null,'B-Pillar Comp',null,null,null,0,null,null);

SELECT * FROM GALADM.MC_OP_PART_REV_TBX;


SELECT * FROM GALADM.MC_OP_MEAS_TBX;


insert into "GALADM"."MC_STRUCTURE_TBX"("PRODUCT_SPEC_CODE","STRUCTURE_REV","PROCESS_POINT_ID","OP_ID","OP_PART_ID") values ('12300NSX C000                 ',1,'PP2             ',1,1);
insert into "GALADM"."MC_STRUCTURE_TBX"("PRODUCT_SPEC_CODE","STRUCTURE_REV","PROCESS_POINT_ID","OP_ID","OP_PART_ID") values ('12300NSX C000                 ',1,'PP2             ',2,2);
insert into "GALADM"."MC_STRUCTURE_TBX"("PRODUCT_SPEC_CODE","STRUCTURE_REV","PROCESS_POINT_ID","OP_ID","OP_PART_ID") values ('12300NSX C000                 ',1,'PP2             ',3,3);
insert into "GALADM"."MC_STRUCTURE_TBX"("PRODUCT_SPEC_CODE","STRUCTURE_REV","PROCESS_POINT_ID","OP_ID","OP_PART_ID") values ('14000NSX C000                 ',1,'PP3             ',4,4);
insert into "GALADM"."MC_STRUCTURE_TBX"("PRODUCT_SPEC_CODE","STRUCTURE_REV","PROCESS_POINT_ID","OP_ID","OP_PART_ID") values ('14000NSX C000                 ',1,'PP3             ',5,5);
insert into "GALADM"."MC_STRUCTURE_TBX"("PRODUCT_SPEC_CODE","STRUCTURE_REV","PROCESS_POINT_ID","OP_ID","OP_PART_ID") values ('15000NSX C000                 ',1,'PP4             ',6,6);
insert into "GALADM"."MC_STRUCTURE_TBX"("PRODUCT_SPEC_CODE","STRUCTURE_REV","PROCESS_POINT_ID","OP_ID","OP_PART_ID") values ('15000NSX C000                 ',1,'PP4             ',7,7);
insert into "GALADM"."MC_STRUCTURE_TBX"("PRODUCT_SPEC_CODE","STRUCTURE_REV","PROCESS_POINT_ID","OP_ID","OP_PART_ID") values ('15000NSX C000                 ',1,'PP4             ',8,8);
insert into "GALADM"."MC_STRUCTURE_TBX"("PRODUCT_SPEC_CODE","STRUCTURE_REV","PROCESS_POINT_ID","OP_ID","OP_PART_ID") values ('15000NSX C000                 ',1,'PP4             ',9,9);

select * from MC_STRUCTURE_TBX;

INSERT INTO MC_ORDER_STRUCTURE_TBX(ORDER_NO, PRODUCT_SPEC_CODE, STRUCTURE_REV) 
VALUES('TESTORDER1', '15000NSX C000', 1);

select * from MC_ORDER_STRUCTURE_TBX;

SELECT STRUCT.PRODUCT_SPEC_CODE,
       STRUCT.STRUCTURE_REV,
       OP.PROCESS_SEQ_NUM,
       STRUCT.PROCESS_POINT_ID,
       OP.OP_SEQ_NUM,
       STRUCT.OPERATION_NAME, 
       STRUCT.OP_REV, 
       STRUCT.PART_ID, 
       STRUCT.PART_REV,
       PART.PART_TYPE,
       PART.PART_MASK,
       MEAS.OP_MEAS_SEQ_NUM,
       MEAS.MINIMUM_LIMIT,
       MEAS.MAXIMUM_LIMIT,
       COALESCE (MEAS.MEAS_VIEW, PART.PART_VIEW, OP.OP_VIEW) AS ACTUAL_VIEW,
       COALESCE (MEAS.MEAS_PROCESSOR, PART.PART_PROCESSOR, OP.OP_PROCESSOR) AS ACTUAL_PROCESSOR
  FROM GALADM.MC_ORDER_STRUCTURE_TBX ORD_STRUCT
       LEFT JOIN GALADM.MC_STRUCTURE_TBX STRUCT
         ON ORD_STRUCT.PRODUCT_SPEC_CODE = STRUCT.PRODUCT_SPEC_CODE
           AND ORD_STRUCT.STRUCTURE_REV = STRUCT.STRUCTURE_REV
       LEFT JOIN GALADM.MC_OP_REV_TBX OP
          ON STRUCT.OPERATION_NAME = OP.OPERATION_NAME AND STRUCT.OP_REV = OP.OP_REV
       LEFT JOIN GALADM.MC_OP_PART_REV_TBX PART
          ON STRUCT.OPERATION_NAME = PART.OPERATION_NAME AND STRUCT.PART_ID = PART.PART_ID AND STRUCT.PART_REV = PART.PART_REV
       LEFT JOIN GALADM.MC_OP_MEAS_TBX MEAS
          ON PART.OPERATION_NAME = MEAS.OPERATION_NAME AND PART.PART_ID = MEAS.PART_ID AND PART.PART_REV = MEAS.PART_REV
 WHERE --ORD_STRUCT.ORDER_NO='TESTORDER1' AND 
 STRUCT.PROCESS_POINT_ID='PP3'
ORDER BY OP.PROCESS_SEQ_NUM, STRUCT.PRODUCT_SPEC_CODE, STRUCT.STRUCTURE_REV DESC, OP.OP_SEQ_NUM, PART.PART_NO, MEAS.OP_MEAS_SEQ_NUM;


insert into "GALADM"."GAL215TBX"("PRODUCT_ID","PROCESS_POINT_ID","ACTUAL_TIMESTAMP","PRODUCT_SPEC_CODE","PRODUCTION_DATE","PRODUCTION_LOT","PROCESS_COUNT") values ('YW20131216123722 ','PP1             ','2013-12-16-12.37.49.000000','11000NSX C000                 ','2013-12-16','PMC 014WCC100000010 ',1);
insert into "GALADM"."GAL215TBX"("PRODUCT_ID","PROCESS_POINT_ID","ACTUAL_TIMESTAMP","PRODUCT_SPEC_CODE","PRODUCTION_DATE","PRODUCTION_LOT","PROCESS_COUNT") values ('YW20131216123722 ','PP2             ','2013-12-16-12.41.43.000000','12300NSX C000                 ','2013-12-16','PMC 014WCC200000020 ',1);
insert into "GALADM"."GAL215TBX"("PRODUCT_ID","PROCESS_POINT_ID","ACTUAL_TIMESTAMP","PRODUCT_SPEC_CODE","PRODUCTION_DATE","PRODUCTION_LOT","PROCESS_COUNT") values ('YW20131216123722 ','PP3             ','2013-12-16-12.43.37.000000','14000NSX C000                 ','2013-12-16','PMC 014WCC400000030 ',1);
insert into "GALADM"."GAL215TBX"("PRODUCT_ID","PROCESS_POINT_ID","ACTUAL_TIMESTAMP","PRODUCT_SPEC_CODE","PRODUCTION_DATE","PRODUCTION_LOT","PROCESS_COUNT") values ('YW20131216123722 ','PP4             ','2013-12-16-12.47.04.000000','15000NSX C000                 ','2013-12-16','PMC 014WCGS00000040 ',1);

select * from GALADM.GAL215TBX where PRODUCT_ID like 'YW%';


insert into "GALADM"."GAL185TBX"("PRODUCT_ID","PART_NAME","PART_SERIAL_NUMBER","PASS_TIME","INSTALLED_PART_REASON","ASSOCIATE_NO","ACTUAL_TIMESTAMP","INSTALLED_PART_STATUS","FIRST_ALARM","SECOND_ALARM","PART_ID","OP_ID","OP_PART_ID") values ('YW20131216123722 ','RF Sub Frame Damper House       ','YW20131216123722 ',null,'                                                                                                                                ','27766      ','2013-12-16-12.41.42.000000',1,null,null,null,1,1);
insert into "GALADM"."GAL185TBX"("PRODUCT_ID","PART_NAME","PART_SERIAL_NUMBER","PASS_TIME","INSTALLED_PART_REASON","ASSOCIATE_NO","ACTUAL_TIMESTAMP","INSTALLED_PART_STATUS","FIRST_ALARM","SECOND_ALARM","PART_ID","OP_ID","OP_PART_ID") values ('YW20131216123722 ','Abiation Right Front Lower      ','L0001',null,'                                                                                                                                ','27766      ','2013-12-16-12.41.43.000000',1,null,null,null,2,2);
insert into "GALADM"."GAL185TBX"("PRODUCT_ID","PART_NAME","PART_SERIAL_NUMBER","PASS_TIME","INSTALLED_PART_REASON","ASSOCIATE_NO","ACTUAL_TIMESTAMP","INSTALLED_PART_STATUS","FIRST_ALARM","SECOND_ALARM","PART_ID","OP_ID","OP_PART_ID") values ('YW20131216123722 ','Abiation Right Front Upper      ','U0001',null,null,'27766      ','2013-12-16-12.41.43.000000',1,null,null,null,3,3);
insert into "GALADM"."GAL185TBX"("PRODUCT_ID","PART_NAME","PART_SERIAL_NUMBER","PASS_TIME","INSTALLED_PART_REASON","ASSOCIATE_NO","ACTUAL_TIMESTAMP","INSTALLED_PART_STATUS","FIRST_ALARM","SECOND_ALARM","PART_ID","OP_ID","OP_PART_ID") values ('YW20131216123722 ','RF Assy                         ','YW20131216123722 ',null,null,'27766      ','2013-12-16-12.43.37.000000',1,null,null,null,4,4);
insert into "GALADM"."GAL185TBX"("PRODUCT_ID","PART_NAME","PART_SERIAL_NUMBER","PASS_TIME","INSTALLED_PART_REASON","ASSOCIATE_NO","ACTUAL_TIMESTAMP","INSTALLED_PART_STATUS","FIRST_ALARM","SECOND_ALARM","PART_ID","OP_ID","OP_PART_ID") values ('YW20131216123722 ','LF Assy                         ','YW20131215010101',null,null,'27766      ','2013-12-16-12.43.37.000000',1,null,null,null,5,5);
insert into "GALADM"."GAL185TBX"("PRODUCT_ID","PART_NAME","PART_SERIAL_NUMBER","PASS_TIME","INSTALLED_PART_REASON","ASSOCIATE_NO","ACTUAL_TIMESTAMP","INSTALLED_PART_STATUS","FIRST_ALARM","SECOND_ALARM","PART_ID","OP_ID","OP_PART_ID") values ('YW20131216123722 ','Front Comp                      ','YW20131216123722 ',null,null,'27766      ','2013-12-16-12.47.04.000000',1,null,null,null,6,6);
insert into "GALADM"."GAL185TBX"("PRODUCT_ID","PART_NAME","PART_SERIAL_NUMBER","PASS_TIME","INSTALLED_PART_REASON","ASSOCIATE_NO","ACTUAL_TIMESTAMP","INSTALLED_PART_STATUS","FIRST_ALARM","SECOND_ALARM","PART_ID","OP_ID","OP_PART_ID") values ('YW20131216123722 ','RR Frame Damper House           ','YW20131215100000',null,null,'27766      ','2013-12-16-12.47.04.000000',1,null,null,null,7,7);
insert into "GALADM"."GAL185TBX"("PRODUCT_ID","PART_NAME","PART_SERIAL_NUMBER","PASS_TIME","INSTALLED_PART_REASON","ASSOCIATE_NO","ACTUAL_TIMESTAMP","INSTALLED_PART_STATUS","FIRST_ALARM","SECOND_ALARM","PART_ID","OP_ID","OP_PART_ID") values ('YW20131216123722 ','LR Frame Damper House           ','YW20131216123722 ',null,null,'27766      ','2013-12-16-12.47.04.000000',1,null,null,null,8,8);
insert into "GALADM"."GAL185TBX"("PRODUCT_ID","PART_NAME","PART_SERIAL_NUMBER","PASS_TIME","INSTALLED_PART_REASON","ASSOCIATE_NO","ACTUAL_TIMESTAMP","INSTALLED_PART_STATUS","FIRST_ALARM","SECOND_ALARM","PART_ID","OP_ID","OP_PART_ID") values ('YW20131216123722 ','B-Pillar Comp                   ','YW20131216123000',null,null,'27766      ','2013-12-16-12.47.04.000000',1,null,null,null,9,9);

SELECT * FROM GALADM.GAL185TBX WHERE PRODUCT_ID LIKE 'YW%'
ORDER BY OP_ID;

SELECT * FROM GALADM.MC_OP_REV_TBX
ORDER BY PROCESS_SEQ_NUM,OP_SEQ_NUM;

--Generate Operations from existing tables
select 
part.PART_NAME AS OPERATION_NAME, ROW_NUMBER() OVER(PARTITION BY PART.PART_NAME ORDER BY MIN(LC_RULE.CREATE_TIMESTAMP)) AS OP_REV, 1 AS REV_ID, part.WINDOW_LABEL AS OP_DESC
,case when LC_RULE.SERIAL_NUMBER_SCAN_FLAG = 1 then 'PART SCAN'
WHEN LC_RULE.SERIAL_NUMBER_SCAN_FLAG = 0 THEN 'PART INSTALL'
ELSE 'NOT_CONFIGURED'
END AS OP_TYPE,coalesce(LC_RULE.STRATEGY,'')||'View' AS OP_VIEW, coalesce(LC_RULE.STRATEGY,'')||'Processor' AS OP_PROCESSOR,0 AS OP_TIME
,part.PART_CONFIRM_CHECK AS OP_CHECK, LC_RULE.PROCESS_POINT_ID AS PROCESS_POINT_ID,(coalesce(DIV.SEQUENCE_NUMBER,0)+1)*1000000+(coalesce(LINE.LINE_SEQUENCE_NUMBER,0)+1)*1000+(coalesce(PP.SEQUENCE_NUMBER,0)+1) AS PROCESS_SEQ_NUM
,LC_RULE.SEQUENCE_NUMBER AS OP_SEQ_NUM, LC_RULE.DEVICE_ID AS DEVICE_ID,LC_RULE.INSTRUCTION_CODE AS DEVICE_MSG
from GALADM.GAL261TBX part 
INNER JOIN GALADM.GAL246TBX LC_RULE ON part.PART_NAME = LC_RULE.PART_NAME
INNER JOIN GALADM.GAL214TBX PP ON LC_RULE.PROCESS_POINT_ID = PP.PROCESS_POINT_ID
INNER JOIN GALADM.GAL195TBX LINE ON PP.LINE_ID = LINE.LINE_ID
INNER JOIN GALADM.GAL128TBX DIV ON LINE.DIVISION_ID = DIV.DIVISION_ID
GROUP BY part.PART_NAME, part.PART_CONFIRM_CHECK, part.WINDOW_LABEL, LC_RULE.PROCESS_POINT_ID, LC_RULE.SEQUENCE_NUMBER, LC_RULE.DEVICE_ID, LC_RULE.INSTRUCTION_CODE, coalesce(LC_RULE.STRATEGY,''),DIV.SEQUENCE_NUMBER,LINE.LINE_SEQUENCE_NUMBER,PP.SEQUENCE_NUMBER,LC_RULE.SERIAL_NUMBER_SCAN_FLAG;

select * from MC_OP_TBX;

--Select the max revision as the current operation
--Still need to determine if this will cause issues during conversion
INSERT INTO GALADM.MC_OP_TBX
(OPERATION_NAME,OP_REV)
(SELECT 
  OPR.OPERATION_NAME, max(OPR.OP_REV)
  FROM GALADM.MC_OP_REV_TBX OPR
  LEFT JOIN GALADM.MC_OP_TBX OP ON OPR.OPERATION_NAME = OP.OPERATION_NAME AND OPR.OP_REV = OP.OP_REV
  WHERE OP.OP_REV IS NULL
  group by OPR.OPERATION_NAME);
  
select * from GALADM.MC_OP_MATRIX_TBX;

--Generate Operations Matrix from existing tables
SELECT OP.OPERATION_NAME, OP.OP_REV
,'PRODUCT' AS SPEC_CODE_TYPE
,REPLACE(REPLACE(REPLACE(REPLACE(LC.MODEL_YEAR_CODE||LC.MODEL_CODE||LC.MODEL_TYPE_CODE||LC.MODEL_OPTION_CODE||LC.INT_COLOR_CODE||LC.EXT_COLOR_CODE,'*  *  * *         ','*'),'*  * *         ','*'),'* *         ','*'),'*  * ','*') AS SPEC_CODE_MASK
FROM (
select 
part.PART_NAME AS OPERATION_NAME, ROW_NUMBER() OVER(PARTITION BY PART.PART_NAME ORDER BY MIN(LC_RULE.CREATE_TIMESTAMP)) AS OP_REV, 1 AS REV_ID, part.WINDOW_LABEL AS OP_DESC
,case when LC_RULE.SERIAL_NUMBER_SCAN_FLAG = 1 then 'PART SCAN'
WHEN LC_RULE.SERIAL_NUMBER_SCAN_FLAG = 0 THEN 'PART INSTALL'
ELSE 'NOT_CONFIGURED'
END AS OP_TYPE,coalesce(LC_RULE.STRATEGY,'')||'View' AS OP_VIEW, coalesce(LC_RULE.STRATEGY,'')||'Processor' AS OP_PROCESSOR,0 AS OP_TIME
,part.PART_CONFIRM_CHECK AS OP_CHECK, LC_RULE.PROCESS_POINT_ID AS PROCESS_POINT_ID,(coalesce(DIV.SEQUENCE_NUMBER,0)+1)*1000000+(coalesce(LINE.LINE_SEQUENCE_NUMBER,0)+1)*1000+(coalesce(PP.SEQUENCE_NUMBER,0)+1) AS PROCESS_SEQ_NUM
,LC_RULE.SEQUENCE_NUMBER AS OP_SEQ_NUM, LC_RULE.DEVICE_ID AS DEVICE_ID,LC_RULE.INSTRUCTION_CODE AS DEVICE_MSG
from GALADM.GAL261TBX part 
INNER JOIN GALADM.GAL246TBX LC_RULE ON part.PART_NAME = LC_RULE.PART_NAME
INNER JOIN GALADM.GAL214TBX PP ON LC_RULE.PROCESS_POINT_ID = PP.PROCESS_POINT_ID
INNER JOIN GALADM.GAL195TBX LINE ON PP.LINE_ID = LINE.LINE_ID
INNER JOIN GALADM.GAL128TBX DIV ON LINE.DIVISION_ID = DIV.DIVISION_ID
GROUP BY part.PART_NAME, part.PART_CONFIRM_CHECK, part.WINDOW_LABEL, LC_RULE.PROCESS_POINT_ID, LC_RULE.SEQUENCE_NUMBER, LC_RULE.DEVICE_ID, LC_RULE.INSTRUCTION_CODE, coalesce(LC_RULE.STRATEGY,''),DIV.SEQUENCE_NUMBER,LINE.LINE_SEQUENCE_NUMBER,PP.SEQUENCE_NUMBER,LC_RULE.SERIAL_NUMBER_SCAN_FLAG) AS OP
LEFT JOIN GALADM.GAL246TBX LC ON OP.OPERATION_NAME=LC.PART_NAME AND OP.PROCESS_POINT_ID=LC.PROCESS_POINT_ID AND OP.OP_SEQ_NUM=LC.SEQUENCE_NUMBER AND COALESCE(OP.DEVICE_ID,'')=COALESCE(LC.DEVICE_ID,'') AND COALESCE(OP.DEVICE_MSG,'')=COALESCE(LC.INSTRUCTION_CODE,'') AND OP.OP_VIEW = coalesce(LC.STRATEGY,'')||'View'
GROUP BY OP.OPERATION_NAME, OP.OP_REV,LC.MODEL_YEAR_CODE||LC.MODEL_CODE||LC.MODEL_TYPE_CODE||LC.MODEL_OPTION_CODE||LC.INT_COLOR_CODE||LC.EXT_COLOR_CODE
;

SELECT * FROM GALADM.MC_OP_PART_REV_TBX PART
ORDER BY PART.OPERATION_NAME, PART.PART_ID, PART.PART_REV;

--Generate parts from existing tables
select 
part.PART_NAME AS OPERATION_NAME, PART_SPEC.PART_ID, ROW_NUMBER() OVER(PARTITION BY PART_SPEC.PART_NAME, PART_SPEC.PART_ID ORDER BY MIN(PART_SPEC.CREATE_TIMESTAMP)) AS PART_REV, 1 AS REV_ID, PART_SPEC.PART_DESCRIPTION AS PART_DESC
,case when LC_RULE.SERIAL_NUMBER_SCAN_FLAG = 1 then 'PART SCAN'
WHEN LC_RULE.SERIAL_NUMBER_SCAN_FLAG = 0 THEN 'PART INSTALL'
ELSE 'NOT_CONFIGURED'
END AS PART_TYPE,NULL AS PART_VIEW, NULL AS PART_PROCESSOR
, LC_RULE.DEVICE_ID AS DEVICE_ID,LC_RULE.INSTRUCTION_CODE AS DEVICE_MSG
, NULL AS PART_NO, NULL AS PART_SECTION_CODE, NULL AS PART_ITEM_NO
, PART_SPEC.PART_SERIAL_NUMBER_MASK AS PART_MASK
, NULL AS PART_MARK
, PART_SPEC.PART_MAX_ATTEMPTS AS PART_MAX_ATTEMPTS
, PART_SPEC.MEASUREMENT_COUNT AS MEASUREMENT_COUNT
,0 AS PART_TIME
,part.PART_CONFIRM_CHECK AS PART_CHECK
from GALADM.GAL261TBX part 
INNER JOIN GALADM.GAL246TBX LC_RULE ON part.PART_NAME = LC_RULE.PART_NAME
INNER JOIN GALADM.GAL245TBX LC_RULE_PART ON LC_RULE.PART_NAME = LC_RULE_PART.PART_NAME AND LC_RULE.MODEL_YEAR_CODE = LC_RULE_PART.MODEL_YEAR_CODE AND LC_RULE.MODEL_CODE = LC_RULE_PART.MODEL_CODE AND LC_RULE.MODEL_TYPE_CODE = LC_RULE_PART.MODEL_TYPE_CODE AND LC_RULE.MODEL_OPTION_CODE = LC_RULE_PART.MODEL_OPTION_CODE AND LC_RULE.INT_COLOR_CODE = LC_RULE_PART.INT_COLOR_CODE AND LC_RULE.EXT_COLOR_CODE = LC_RULE_PART.EXT_COLOR_CODE
INNER JOIN GALADM.PART_SPEC_TBX PART_SPEC ON LC_RULE_PART.PART_NAME = PART_SPEC.PART_NAME AND LC_RULE_PART.PART_ID = PART_SPEC.PART_ID
INNER JOIN GALADM.GAL214TBX PP ON LC_RULE.PROCESS_POINT_ID = PP.PROCESS_POINT_ID
INNER JOIN GALADM.GAL195TBX LINE ON PP.LINE_ID = LINE.LINE_ID
INNER JOIN GALADM.GAL128TBX DIV ON LINE.DIVISION_ID = DIV.DIVISION_ID
GROUP BY part.PART_NAME,PART_SPEC.PART_NAME,PART_SPEC.PART_ID,PART_SPEC.PART_DESCRIPTION,LC_RULE.SERIAL_NUMBER_SCAN_FLAG
,LC_RULE.DEVICE_ID,LC_RULE.INSTRUCTION_CODE,PART_SPEC.PART_SERIAL_NUMBER_MASK,PART_SPEC.PART_MAX_ATTEMPTS,PART_SPEC.MEASUREMENT_COUNT
, part.PART_CONFIRM_CHECK;

SELECT * FROM GALADM.MC_OP_PART_TBX;

--Select the max revision as the current part
--Still need to determine if this will cause issues during conversion
INSERT INTO GALADM.MC_OP_PART_TBX
(OPERATION_NAME,PART_ID,PART_REV)
(SELECT OPR.OPERATION_NAME, OPR.PART_ID, max (OPR.PART_REV)
  FROM    GALADM.MC_OP_PART_REV_TBX OPR
       LEFT JOIN
          GALADM.MC_OP_PART_TBX OP
       ON     OPR.OPERATION_NAME = OP.OPERATION_NAME
          AND OPR.PART_ID = OP.PART_ID
          AND OPR.PART_REV = OP.PART_REV
 WHERE OP.PART_REV IS NULL
GROUP BY OPR.OPERATION_NAME, OPR.PART_ID);

SELECT * FROM GALADM.MC_OP_PART_MATRIX_TBX;

--Generate parts MATRIX from existing tables
SELECT PARTS.OPERATION_NAME, PARTS.PART_ID, PARTS.PART_REV
,'PRODUCT' AS SPEC_CODE_TYPE
,REPLACE(REPLACE(REPLACE(REPLACE(LC.MODEL_YEAR_CODE||LC.MODEL_CODE||LC.MODEL_TYPE_CODE||LC.MODEL_OPTION_CODE||LC.INT_COLOR_CODE||LC.EXT_COLOR_CODE,'*  *  * *         ','*'),'*  * *         ','*'),'* *         ','*'),'*  * ','*') AS SPEC_CODE_MASK
FROM (
select 
part.PART_NAME AS OPERATION_NAME, PART_SPEC.PART_ID, ROW_NUMBER() OVER(PARTITION BY PART_SPEC.PART_NAME, PART_SPEC.PART_ID ORDER BY MIN(PART_SPEC.CREATE_TIMESTAMP)) AS PART_REV, 1 AS REV_ID, PART_SPEC.PART_DESCRIPTION AS PART_DESC
,case when LC_RULE.SERIAL_NUMBER_SCAN_FLAG = 1 then 'PART SCAN'
WHEN LC_RULE.SERIAL_NUMBER_SCAN_FLAG = 0 THEN 'PART INSTALL'
ELSE 'NOT_CONFIGURED'
END AS PART_TYPE,NULL AS PART_VIEW, NULL AS PART_PROCESSOR
, LC_RULE.DEVICE_ID AS DEVICE_ID,LC_RULE.INSTRUCTION_CODE AS DEVICE_MSG
, NULL AS PART_NO, NULL AS PART_SECTION_CODE, NULL AS PART_ITEM_NO
, PART_SPEC.PART_SERIAL_NUMBER_MASK AS PART_MASK
, NULL AS PART_MARK
, PART_SPEC.PART_MAX_ATTEMPTS AS PART_MAX_ATTEMPTS
, PART_SPEC.MEASUREMENT_COUNT AS MEASUREMENT_COUNT
,0 AS PART_TIME
,part.PART_CONFIRM_CHECK AS PART_CHECK
from GALADM.GAL261TBX part 
INNER JOIN GALADM.GAL246TBX LC_RULE ON part.PART_NAME = LC_RULE.PART_NAME
INNER JOIN GALADM.GAL245TBX LC_RULE_PART ON LC_RULE.PART_NAME = LC_RULE_PART.PART_NAME AND LC_RULE.MODEL_YEAR_CODE = LC_RULE_PART.MODEL_YEAR_CODE AND LC_RULE.MODEL_CODE = LC_RULE_PART.MODEL_CODE AND LC_RULE.MODEL_TYPE_CODE = LC_RULE_PART.MODEL_TYPE_CODE AND LC_RULE.MODEL_OPTION_CODE = LC_RULE_PART.MODEL_OPTION_CODE AND LC_RULE.INT_COLOR_CODE = LC_RULE_PART.INT_COLOR_CODE AND LC_RULE.EXT_COLOR_CODE = LC_RULE_PART.EXT_COLOR_CODE
INNER JOIN GALADM.PART_SPEC_TBX PART_SPEC ON LC_RULE_PART.PART_NAME = PART_SPEC.PART_NAME AND LC_RULE_PART.PART_ID = PART_SPEC.PART_ID
INNER JOIN GALADM.GAL214TBX PP ON LC_RULE.PROCESS_POINT_ID = PP.PROCESS_POINT_ID
INNER JOIN GALADM.GAL195TBX LINE ON PP.LINE_ID = LINE.LINE_ID
INNER JOIN GALADM.GAL128TBX DIV ON LINE.DIVISION_ID = DIV.DIVISION_ID
GROUP BY part.PART_NAME,PART_SPEC.PART_NAME,PART_SPEC.PART_ID,PART_SPEC.PART_DESCRIPTION,LC_RULE.SERIAL_NUMBER_SCAN_FLAG
,LC_RULE.DEVICE_ID,LC_RULE.INSTRUCTION_CODE,PART_SPEC.PART_SERIAL_NUMBER_MASK,PART_SPEC.PART_MAX_ATTEMPTS,PART_SPEC.MEASUREMENT_COUNT
, part.PART_CONFIRM_CHECK) AS PARTS
LEFT JOIN GALADM.GAL245TBX AS LC ON PARTS.OPERATION_NAME = LC.PART_NAME AND PARTS.PART_ID = LC.PART_ID;


--SQL to create structure
WITH INPUT (IN_PLANT_NAME, IN_PRODUCT_SPEC_CODE, IN_STRUCTURE_REV, IN_SPEC_CODE_TYPE)
--Use WITH for easy way to identify the input parameters for this SQL
     AS (VALUES ('Frame','9SVKAA000 B536P     B ',1,'PRODUCT'))
--To support only having to define the matrix on the operation or the part need to do a full outer join
--Use COALESCE for the scenario of matrix only defined on part
SELECT COALESCE (OPS.PRODUCT_SPEC_CODE, PARTS.PRODUCT_SPEC_CODE) AS PRODUCT_SPEC_CODE,
       COALESCE (OPS.STRUCTURE_REV, PARTS.STRUCTURE_REV) AS STRUCTURE_REV,
       COALESCE (OPS.PROCESS_POINT_ID, PARTS.PROCESS_POINT_ID) AS PROCESS_POINT_ID,
       COALESCE (OPS.OPERATION_NAME, PARTS.OPERATION_NAME) AS OPERATION_NAME,
       COALESCE (OPS.OP_REV, PARTS.OP_REV) AS OP_REV,
       PARTS.PART_ID,
       PARTS.PART_REV
  FROM    
  --Determine which Operations should be performed
  (SELECT INPUT.IN_PRODUCT_SPEC_CODE AS PRODUCT_SPEC_CODE,
                  INPUT.IN_STRUCTURE_REV AS STRUCTURE_REV,
                  PP.PROCESS_POINT_ID AS PROCESS_POINT_ID,
                  OP_REV.OPERATION_NAME AS OPERATION_NAME,
                  OP_REV.OP_REV AS OP_REV
             FROM INPUT,
                           GALADM.GAL214TBX PP
                        INNER JOIN
                           GALADM.MC_OP_REV_TBX OP_REV
                        ON OP_REV.PROCESS_POINT_ID = PP.PROCESS_POINT_ID
                     INNER JOIN
                        GALADM.MC_OP_TBX OP
                     ON     OP_REV.OPERATION_NAME = OP.OPERATION_NAME
                        AND OP_REV.OP_REV = OP.OP_REV
                  INNER JOIN
                     GALADM.MC_OP_MATRIX_TBX OP_MATRIX
                  ON     OP_REV.OPERATION_NAME = OP_MATRIX.OPERATION_NAME
                     AND OP_REV.OP_REV = OP_MATRIX.OP_REV
            WHERE     PP.PLANT_NAME = INPUT.IN_PLANT_NAME
                  AND ( (    OP_MATRIX.SPEC_CODE_TYPE =
                                INPUT.IN_SPEC_CODE_TYPE
                         AND INPUT.IN_PRODUCT_SPEC_CODE LIKE
                                REPLACE (
                                   REPLACE (OP_MATRIX.SPEC_CODE_MASK,
                                            '*','%'), --Convert GALC standard of * to DB2 % to match any characters
                                   '#','_'))) -- Convert GALC standard of # to DB2 _ to match single character
           GROUP BY INPUT.IN_PRODUCT_SPEC_CODE,
                    INPUT.IN_STRUCTURE_REV,
                    PP.PROCESS_POINT_ID,
                    OP_REV.OPERATION_NAME,
                    OP_REV.OP_REV) OPS
       FULL OUTER JOIN --Use full outer so that users only have to define matrix on parts or operations
          --Determine which parts should be used
          (SELECT INPUT.IN_PRODUCT_SPEC_CODE AS PRODUCT_SPEC_CODE,
                  INPUT.IN_STRUCTURE_REV AS STRUCTURE_REV,
                  PP.PROCESS_POINT_ID AS PROCESS_POINT_ID,
                  OP_REV.OPERATION_NAME AS OPERATION_NAME,
                  OP_REV.OP_REV AS OP_REV,
                  OP_PART_REV.PART_ID,
                  OP_PART_REV.PART_REV
             FROM INPUT,
                                 GALADM.GAL214TBX PP
                              INNER JOIN
                                 GALADM.MC_OP_REV_TBX OP_REV
                              ON OP_REV.PROCESS_POINT_ID =
                                    PP.PROCESS_POINT_ID
                           INNER JOIN
                              GALADM.MC_OP_TBX OP
                           ON     OP_REV.OPERATION_NAME = OP.OPERATION_NAME
                              AND OP_REV.OP_REV = OP.OP_REV
                        INNER JOIN
                           GALADM.MC_OP_PART_TBX OP_PART
                        ON OP_REV.OPERATION_NAME = OP_PART.OPERATION_NAME
                     INNER JOIN
                        GALADM.MC_OP_PART_REV_TBX OP_PART_REV
                     ON     OP_PART.OPERATION_NAME =
                               OP_PART_REV.OPERATION_NAME
                        AND OP_PART.PART_ID = OP_PART_REV.PART_ID
                        AND OP_PART.PART_REV = OP_PART_REV.PART_REV
                  INNER JOIN
                     GALADM.MC_OP_PART_MATRIX_TBX PART_MATRIX
                  ON     OP_PART_REV.OPERATION_NAME =
                            PART_MATRIX.OPERATION_NAME
                     AND OP_PART_REV.PART_ID = PART_MATRIX.PART_ID
                     AND OP_PART_REV.PART_REV = PART_MATRIX.PART_REV
            WHERE     PP.PLANT_NAME = INPUT.IN_PLANT_NAME
                  AND ( (    PART_MATRIX.SPEC_CODE_TYPE =
                                INPUT.IN_SPEC_CODE_TYPE                     
                         AND INPUT.IN_PRODUCT_SPEC_CODE LIKE
                                REPLACE (
                                   REPLACE (PART_MATRIX.SPEC_CODE_MASK,
                                            '*','%'), --Convert GALC standard of * to DB2 % to match any characters
                                   '#','_'))) -- Convert GALC standard of # to DB2 _ to match single character
           GROUP BY INPUT.IN_PRODUCT_SPEC_CODE,
                    INPUT.IN_STRUCTURE_REV,
                    PP.PROCESS_POINT_ID,
                    OP_REV.OPERATION_NAME,
                    OP_REV.OP_REV,
                    OP_PART_REV.PART_ID,
                    OP_PART_REV.PART_REV) PARTS
       ON     OPS.PRODUCT_SPEC_CODE = PARTS.PRODUCT_SPEC_CODE
          AND OPS.STRUCTURE_REV = PARTS.STRUCTURE_REV
          AND OPS.PROCESS_POINT_ID = PARTS.PROCESS_POINT_ID
          AND OPS.OPERATION_NAME = PARTS.OPERATION_NAME;

     