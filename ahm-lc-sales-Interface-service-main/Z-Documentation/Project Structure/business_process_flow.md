# Honda AHM LC Sales Interface Service - Business Process Flow

## Main Business Processes

### 1. Shipping Process Flow (GALC → YMS)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                                     Shipping Process Flow                                           │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                                 ShippingMessageScheduler                                            │
│                                 (Runs on configured schedule)                                       │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                                 ShippingTransactionTask.execute()                                   │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Read message from GALC Queue (LC Receiving Queue)                              │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Parse message into DataContainer object                                        │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
                                        ┌──────────────┐
                                        │ Status Type? │
                                        └──────┬───────┘
                                               │
                         ┌─────────────────────┴─────────────────────┐
                         │                                           │
                         ▼                                           ▼
┌────────────────────────────────────────┐        ┌────────────────────────────────────────┐
│                                        │        │                                        │
│           VQ_SHIP Status               │        │           AF_OFF Status                │
│                                        │        │                                        │
└────────────────────┬───────────────────┘        └────────────────────┬───────────────────┘
                     │                                                  │
                     ▼                                                  ▼
┌────────────────────────────────────────┐        ┌────────────────────────────────────────┐
│                                        │        │                                        │
│     Retrieve shipping data from GALC   │        │     Retrieve AF_OFF data from GALC     │
│     (get50ATransactionVin)             │        │     (getFrame, getFrameSpec)           │
│                                        │        │                                        │
└────────────────────┬───────────────────┘        └────────────────────┬───────────────────┘
                     │                                                  │
                     └────────────────────┬─────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Generate ShippingMessage with vehicle details                                  │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Convert ShippingMessage to JSON                                                │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Send message to YMS Queue (Sales Shipping Queue)                               │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Update GALC with shipping status                                               │
│                      - Update ShippingTransaction (sendFlag = 'Y')                                  │
│                      - Update ShippingStatus (status = 1)                                           │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      If errors occurred, send email notification                                    │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2. Status Update Process Flow (YMS → GALC)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                                  Status Update Process Flow                                         │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                                 StatusMessageScheduler                                              │
│                                 (Runs on configured schedule)                                       │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                                 ReceivingTransactionTask.execute()                                  │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Read message from YMS Queue (Sales Receiving Queue)                            │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Parse message into StatusMessage object                                        │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      StatusMessageHandlerFactory.handleMessage()                                    │
│                      (Routes message to appropriate handler)                                        │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
                                        ┌──────────────┐
                                        │ Status Type? │
                                        └──────┬───────┘
                                               │
         ┌───────────┬───────────┬───────────┬─┴─────────┬───────────┬───────────┬───────────┐
         │           │           │           │           │           │           │           │
         ▼           ▼           ▼           ▼           ▼           ▼           ▼           ▼
┌─────────────┐┌─────────────┐┌─────────────┐┌─────────────┐┌─────────────┐┌─────────────┐┌─────────────┐
│             ││             ││             ││             ││             ││             ││             │
│  AH_RCVD    ││  AH_PCHG    ││  DLR_ASGN   ││   AH_RTN    ││  AH_SHIP    ││   PPO_ON    ││  Other      │
│  Handler    ││  Handler    ││  Handler    ││  Handler    ││  Handler    ││  Handler    ││  Handlers   │
│             ││             ││             ││             ││             ││             ││             │
└──────┬──────┘└──────┬──────┘└──────┬──────┘└──────┬──────┘└──────┬──────┘└──────┬──────┘└──────┬──────┘
       │              │              │              │              │              │              │
       └──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Retrieve current ShippingStatus from GALC                                      │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Update ShippingStatus with new status                                          │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      Track product update in GALC                                                   │
│                      (Call trackProduct with appropriate process point ID)                          │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                      If errors occurred, send email notification                                    │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Data Models and Relationships

```
┌───────────────────────┐       ┌───────────────────────┐       ┌───────────────────────┐
│                       │       │                       │       │                       │
│    ShippingStatus     │◄──────┤    ShippingTransaction│◄──────┤        Frame          │
│                       │       │                       │       │                       │
└───────────┬───────────┘       └───────────┬───────────┘       └───────────┬───────────┘
            │                               │                               │
            │                               │                               │
            │                               │                               │
            │                               │                               │
            ▼                               ▼                               ▼
┌───────────────────────┐       ┌───────────────────────┐       ┌───────────────────────┐
│                       │       │                       │       │                       │
│    StatusMessage      │       │    ShippingMessage    │       │      FrameSpec        │
│                       │       │                       │       │                       │
└───────────────────────┘       └───────────────────────┘       └───────────────────────┘
```

## Configuration and Environment Setup

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                                     Configuration Properties                                        │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────┐       ┌───────────────────────┐       ┌───────────────────────┐
│                       │       │                       │       │                       │
│  IBM MQ Configuration │       │  GALC API Endpoints   │       │  Process Point IDs    │
│  - Queue Manager      │       │  - Base URL           │       │  - AH-RCVD            │
│  - Channel            │       │  - Tracking URL       │       │  - DLR-ASGN           │
│  - Connection Name    │       │  - FindByKey method   │       │  - AH-SHIP            │
│  - User               │       │  - Save method        │       │  - AH-RTN             │
│                       │       │                       │       │  - etc.               │
└───────────────────────┘       └───────────────────────┘       └───────────────────────┘

┌───────────────────────┐       ┌───────────────────────┐       ┌───────────────────────┐
│                       │       │                       │       │                       │
│  Email Configuration  │       │  Scheduler Settings   │       │  Application Settings │
│  - SMTP Host          │       │  - Ship cron expr     │       │  - Product type       │
│  - Port               │       │  - Status cron expr   │       │  - Plant name         │
│  - From address       │       │  - Job enable flags   │       │  - Destination site   │
│  - To address         │       │                       │       │  - Environment        │
│                       │       │                       │       │                       │
└───────────────────────┘       └───────────────────────┘       └───────────────────────┘
```