<mat-sidenav-container style="height: calc(100% - 60px); overflow: hidden;">
   <mat-sidenav #sidenav position="end" style="width: 15%;">
      <div fxLayout="column" fxLayoutAlign="space-between stretch" fxLayoutGap="25px">
         <div class="mat-elevation-z2" fxLayout="column" fxLayoutAlign="space-evenly start"
            style="padding: 0.5vw; text-align: left; position: sticky; top:0; z-index: 999; background-color: rgb(240, 244, 247);">
            <span>
               <b>Actuals:</b>
            </span>
            <span>
               <mat-nav-list *ngFor="let cd of departmentData" style="padding-left: 3vw;">
                  <mat-checkbox [(ngModel)]="cd.visible" [value]="cd.departmentName"
                  (change)="showDepartment($event, ACT)">
                     <div style="margin-right: 1.5vw;">
                        {{cd.departmentName}}
                     </div>
                  </mat-checkbox>
               </mat-nav-list>
            </span>
         </div>
         <div class="mat-elevation-z2" fxLayout="column" fxLayoutAlign="space-evenly start"
            style="padding: 0.5vw; text-align: left;position: sticky; top:0; z-index: 999; background-color: rgb(240, 244, 247);">
            <span>
               <b>Inventory:</b>
            </span>
            <span>
               <mat-nav-list *ngFor="let cd of invDepartmentData" style="padding-left: 3vw;">
                  <mat-checkbox [(ngModel)]="cd.visible" [value]="cd.departmentName"
                  (change)="showDepartment($event, INV)">
                     <div style="margin-right: 1.5vw;">
                        {{cd.departmentName}}
                     </div>
                  </mat-checkbox>
               </mat-nav-list>
            </span>
         </div>
      </div>
   </mat-sidenav>
   <mat-sidenav-content>
      <div id="scrollable-area" fxLayout="row" fxLayoutAlign="space-between stretch" class="mat-elevation-z4">
         <div style="width: 65%; height: 100%; overflow:auto; margin-right: 5px;" class="mat-elevation-z4">
            <div *ngIf="isActualSpinnerVisible" fxLayout="row" fxLayoutAlign="space-around center" style="height: 80%">
               <mat-spinner diameter="50" strokeWidth="5" ></mat-spinner>
            </div>
            <table *ngIf="!isActualSpinnerVisible" #table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z0"
               fixed-table-headers="scrollable-area">
               <ng-container matColumnDef="expandSymbol">
                  <th mat-header-cell *matHeaderCellDef></th>
                  <td mat-cell *matCellDef="let element" class="groupBlueBoldtablecell">
                     <span *ngIf="element.iconToggle" class="material-icons" style="cursor: pointer;">
                        expand_less
                     </span>
                     <span *ngIf="!element.iconToggle" class="material-icons" style="cursor: pointer;">
                        expand_more
                     </span>
                  </td>
               </ng-container>
               <!-- Group Header-->
               <ng-container matColumnDef="department">
                  <td mat-cell *matCellDef="let element" class="groupBlueBoldtablecell">Dept: {{element.departmentName}}</td>
               </ng-container>
               <ng-container matColumnDef="plan">
                  <td mat-cell *matCellDef="let element" class="groupBlueBoldtablecell">
                     <span *ngIf="element.showPlan">
                        Plan: {{element.plan}}
                     </span>
                  </td>
               </ng-container>
               <ng-container matColumnDef="target">
                  <td mat-cell *matCellDef="let element" class="groupBlueBoldtablecell">
                     <span *ngIf="element.showPlan && dataMode==='now'">
                        Target: {{element.target}}
                     </span>
                  </td>
               </ng-container>
               <ng-container matColumnDef="expandedDetail">
                  <td mat-cell *matCellDef="let element" [attr.colspan]="groupByColumns.length">
                     <div class="example-element-detail" *ngIf="element.processPointGroupData"
                        [@detailExpand]="element != expandedElement ? (element.iconToggle?'expanded' : 'collapsed' ) : (!element.iconToggle?'collapsed' : 'expanded' )"
                        (contextmenu)="onRightClick($event, {content: 'Item ' })">
                        <table #innerTables mat-table [dataSource]="element.processPointGroupData"
                           [class.hidden]="!element.visible">
                           <!-- Tracking Status -->
                           <ng-container matColumnDef="Line">
                              <th style="width: 16%;" mat-header-cell *matHeaderCellDef class="table-cell">
                                 Tracking Status</th>
                              <td style="width: 16%;" mat-cell *matCellDef="let line" class="blueBoldtablecell" matTooltip="{{line.processPointData}}">
                                 {{line.processPointGroup}} </td>
                           </ng-container>
                           <!--Actual 3rd-->
                           <ng-container matColumnDef="Actual 3rd">
                              <th style="width: 7.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                 Actual 3rd</th>
                              <td style="width: 7.5%;" mat-cell *matCellDef="let line" class="table-cell"> {{line.actual3rd}}
                              </td>
                           </ng-container>
                           <!--Gap 3rd-->
                           <ng-container matColumnDef="Gap 3rd">
                              <th style="width: 7.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                 Gap 3rd</th>
                              <td style="width: 7.5%;" mat-cell *matCellDef="let line"
                                 [class.redtablecell]="line.gap3rd<0" class="table-cell">
                                 <span *ngIf="line.calculateDifference">{{line.gap3rd}}</span>
                              </td>
                           </ng-container>
                           <!--Actual 1st-->
                           <ng-container matColumnDef="Actual 1st">
                              <th style="width: 7.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                 Actual 1st</th>
                              <td style="width: 7.5%;" mat-cell *matCellDef="let line" class="table-cell"> {{line.actual1st}}
                              </td>
                           </ng-container>
                           <!--Gap 1st-->
                           <ng-container matColumnDef="Gap 1st">
                              <th style="width: 7.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                 Gap 1st</th>
                              <td style="width: 7.5%;" mat-cell *matCellDef="let line"
                                 [class.redtablecell]="line.gap1st<0" class="table-cell">
                                 <span *ngIf="line.calculateDifference">{{line.gap1st}}</span>
                              </td>
                           </ng-container>
                           <!--Actual 2nd-->
                           <ng-container matColumnDef="Actual 2nd">
                              <th style="width: 7.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                 Actual 2nd</th>
                              <td style="width: 7.5%;" mat-cell *matCellDef="let line" class="table-cell"> {{line.actual2nd}}
                              </td>
                           </ng-container>
                           <!--Gap 2nd-->
                           <ng-container matColumnDef="Gap 2nd">
                              <th style="width: 7.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                 Gap 2nd</th>
                              <td style="width: 7.5%;" mat-cell *matCellDef="let line"
                                 [class.redtablecell]="line.gap2nd<0" class="table-cell">
                                 <span *ngIf="line.calculateDifference">{{line.gap2nd}}</span>
                              </td>
                           </ng-container>
                           <!--Actual Total-->
                           <ng-container matColumnDef="Actual Total">
                              <th style="width: 8.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                 Actual Total</th>
                              <td style="width: 8.5%;" mat-cell *matCellDef="let line" class="table-cell">
                                 {{line.actualTotal}} </td>
                           </ng-container>
                           <!--Difference-->
                           <ng-container matColumnDef="Difference">
                              <th style="width: 6.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                 Total Gap</th>
                              <td style="width: 6.5%;" mat-cell *matCellDef="let line"
                                 [class.redtablecell]="line.difference<0" class="table-cell">
                                 <span *ngIf="line.calculateDifference">{{line.difference}}</span>
                              </td>
                           </ng-container>

                           <!--Gap to AF-->
                           <ng-container matColumnDef="Gap To AF">
                              <th [class.hiddenCol]="element.productType != 'FRAME'" style="width: 10%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                 <span *ngIf="element.departmentSequence < afDepartmentSeq">
                                    Gap to AF On
                                 </span>
                                 <span *ngIf="element.departmentSequence == afDepartmentSeq">
                                    Gap to AF
                                 </span>
                                 <span *ngIf="element.departmentSequence > afDepartmentSeq">
                                    Gap to AF Off
                                 </span>
                              </th>
                              <td [class.hiddenCol]="element.productType != 'FRAME'" style="width: 7.5%;" mat-cell *matCellDef="let line"
                                 [class.redBackTableCell]="line.gapToAF<0 && line.calculateDifference" 
                                 [class.greenBackTableCell]="line.gapToAF>0 && line.calculateDifference" 
                                 class="table-cell">
                                    <span *ngIf="line.calculateDifference">{{line.gapToAF}}</span>
                              </td>
                           </ng-container>
      
                           <tr mat-header-row *matHeaderRowDef="innerColumnsToDisplay; sticky: false" class="header-row"></tr>
                           <tr mat-row *matRowDef="let element;  columns:innerColumnsToDisplay; sticky: false"
                              class="table-row"> </tr>
      
                        </table>
                     </div>
                  </td>
               </ng-container>
               <tr mat-row *matRowDef="let element; columns: groupByColumns;sticky: false "
                  [class.example-element-row]="element.processPointGroupData"
                  [class.example-expanded-row]="expandedElement === element" (click)="toggleRow(element)" class="table-row"
                  [class.hidden]="!element.visible"> </tr>
               <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
            </table>
         </div>
         <div style="width: 35%; height: 100%; overflow:auto; margin-left: 5px;" class="mat-elevation-z4">
            <div fxLayout="column" fxLayoutAlign="space-around center">
            <div style="width: 100%;">               
               <div *ngIf="isMetricSpinnerVisible" fxLayout="row" fxLayoutAlign="space-around center" style="height: 100%">
                  <mat-spinner diameter="50" strokeWidth="5" ></mat-spinner>
               </div>
               <!-- Metrics Table Start -->
               <table *ngIf="!isMetricSpinnerVisible && showMetrics" #metTable mat-table [dataSource]="metricsDataSource" multiTemplateDataRows class="mat-elevation-z0"
                  fixed-table-headers="scrollable-area">
                  <ng-container matColumnDef="expandSymbol">
                  <th mat-header-cell *matHeaderCellDef></th>
                  <td mat-cell *matCellDef="let element" class="groupBlueBoldtablecell">
                     <span *ngIf="element.iconToggle" class="material-icons" style="cursor: pointer;">
                        expand_less
                     </span>
                     <span *ngIf="!element.iconToggle" class="material-icons" style="cursor: pointer;">
                        expand_more
                     </span>
                  </td>
                  </ng-container>
                  <!-- Group Header-->
                  <ng-container matColumnDef="title">
                  <td mat-cell *matCellDef="let element" class="groupBlueBoldtablecell">Metrics</td>
                  </ng-container>
                  <ng-container matColumnDef="expandedDetail">
                  <td mat-cell *matCellDef="let element" [attr.colspan]="metricsGroupByColumns.length">
                     <div class="example-element-detail" *ngIf="element.metricsData"
                        [@detailExpand]="element != metricsExpandedElement ? (element.iconToggle?'expanded' : 'collapsed' ) : (!element.iconToggle?'collapsed' : 'expanded' )">
                        <table #metricsInnerTables mat-table
                           [dataSource]="element.metricsData" style="margin-bottom: 5px;">
                           <!-- Metric Name -->
                           <ng-container matColumnDef="metricName">
                           <th style="width: 16%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                              Metric Name</th>
                           <td style="width: 16%;" mat-cell *matCellDef="let metric" class="blueBoldtablecell" matTooltip="{{metric.tooltip}}">
                              {{metric.metricName}} </td>
                           </ng-container>
                           <!--First Shift-->
                           <ng-container matColumnDef="countFirst">
                           <th style="width: 10.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                              1st Shift</th>
                           <td style="width: 10.5%;" mat-cell *matCellDef="let metric" class="table-cell">
                              {{metric.countFirst}}{{metric.unit}}</td>
                           </ng-container>
                           <!--Second Shift-->
                           <ng-container matColumnDef="countSecond">
                           <th style="width: 10.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                              2nd Shift</th>
                           <td style="width: 10.5%;" mat-cell *matCellDef="let metric" class="table-cell">
                              {{metric.countSecond}}{{metric.unit}}</td>
                           </ng-container>
                           <!--Third Shift-->
                           <ng-container matColumnDef="countThird">
                           <th style="width: 10.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                              3rd Shift</th>
                           <td style="width: 10.5%;" mat-cell *matCellDef="let metric" class="table-cell">
                              {{metric.countThird}}{{metric.unit}}</td>
                           </ng-container>
               
                           <tr mat-header-row *matHeaderRowDef="metricsInnerColumnsToDisplay; sticky: false" class="header-row"></tr>
                           <tr mat-row *matRowDef="let element;  columns:metricsInnerColumnsToDisplay; sticky: false"
                           class="table-row"> </tr>
                        </table>
                     </div>
                  </td>
                  </ng-container>
                  <tr mat-row *matRowDef="let element; columns: metricsGroupByColumns;sticky: false "
                  [class.example-element-row]="element.metricsData"
                  [class.example-expanded-row]="metricsExpandedElement === element" (click)="metricsToggleRow(element)"
                  class="table-row"> </tr>
                  <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
               </table>
               <!-- Metrics Table End -->               
            </div>
            <div style="width: 100%;">
               <div *ngIf="isInvSpinnerVisible" fxLayout="row" fxLayoutAlign="space-around center" style="height: 100%">
                  <mat-spinner diameter="50" strokeWidth="5" ></mat-spinner>
               </div>
               <table *ngIf="!isInvSpinnerVisible" #invTable mat-table [dataSource]="invDataSource" multiTemplateDataRows class="mat-elevation-z0"
                  fixed-table-headers="scrollable-area">
                  <ng-container matColumnDef="expandSymbol">
                     <th mat-header-cell *matHeaderCellDef></th>
                     <td mat-cell *matCellDef="let element" class="groupBlueBoldtablecell">
                        <span *ngIf="element.iconToggle" class="material-icons" style="cursor: pointer;">
                           expand_less
                        </span>
                        <span *ngIf="!element.iconToggle" class="material-icons" style="cursor: pointer;">
                           expand_more
                        </span>
                     </td>
                  </ng-container>
                  <!-- Group Header-->
                  <ng-container matColumnDef="department">
                     <td mat-cell *matCellDef="let element" class="groupBlueBoldtablecell">Dept: {{element.departmentName}}</td>
                  </ng-container>
                  <ng-container matColumnDef="totalInventory">
                     <td mat-cell *matCellDef="let element" class="groupBlueBoldtablecell">Total Inventory: <span>{{element.totalInventoryByDiv}}</span></td>
                  </ng-container>
                  <ng-container matColumnDef="expandedDetail">
                     <td mat-cell *matCellDef="let element" [attr.colspan]="invGroupByColumns.length">
                        <div class="example-element-detail" *ngIf="element.processPointGroupData"
                           [@detailExpand]="element != invExpandedElement ? (element.iconToggle?'expanded' : 'collapsed' ) : (!element.iconToggle?'collapsed' : 'expanded' )">
                           <table #invInnerTables mat-table
                              [dataSource]="element.processPointGroupData" [class.hidden]="!element.visible">
                              <!-- Process Point Group -->
                              <ng-container matColumnDef="line">
                                 <th style="width: 16%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                    Inventory Group</th>
                                 <td style="width: 16%;" mat-cell *matCellDef="let line" class="blueBoldtablecell" matTooltip="{{line.processPointData}}">
                                    {{line.processPointGroup}} </td>
                              </ng-container>
                              <!--Current Inventory-->
                              <ng-container matColumnDef="current inventory">
                                 <th style="width: 10.5%;" mat-header-cell *matHeaderCellDef class="table-cell" >
                                    Current Inventory</th>
                                 <td style="width: 10.5%;" mat-cell *matCellDef="let line" class="table-cell">
                                    {{line.currentInventory}} </td>
                              </ng-container>
         
                              <tr mat-header-row *matHeaderRowDef="invInnerColumnsToDisplay; sticky: false" class="header-row"></tr>
                              <tr mat-row *matRowDef="let element;  columns:invInnerColumnsToDisplay; sticky: false"
                                 class="table-row"> </tr>
                           </table>
                        </div>
                     </td>
                  </ng-container>
                  <tr mat-row *matRowDef="let element; columns: invGroupByColumns;sticky: false "
                     [class.example-element-row]="element.processPointGroupData"
                     [class.example-expanded-row]="invExpandedElement === element" (click)="invToggleRow(element)"
                     class="table-row" [class.hidden]="!element.visible"> </tr>
                  <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
               </table>
            </div>
            </div>
         </div>
      </div>
      <!-- an hidden div is created to set the position of appearance of the menu-->
      <div>
         <div style="visibility: hidden; position: fixed;" [style.left]="menuTopLeftPosition.x"
            [style.top]="menuTopLeftPosition.y" [matMenuTriggerFor]="rightMenu">
         </div>
      
         <mat-menu #rightMenu="matMenu">
            <ng-template matMenuContent let-item="item">
               <button style="color: whitesmoke;" mat-menu-item *ngFor="let item of masterCopyOfInnerColumn" (click)="onContextMenuAction(item)">
                  <mat-icon [ngStyle]="{'color':'white'}">{{innerColumnsToDisplay.indexOf(item) > -1?'done':''}}</mat-icon>{{item}}
               </button>
            </ng-template>
         </mat-menu>
      </div>

   </mat-sidenav-content>
</mat-sidenav-container>
